@using B1809531_EShop_MVC6.Helpers;
@using Microsoft.AspNetCore.Http.Extensions;
@model ProductModel
@{
    ViewData["Title"] = "Chi tiết sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var relatedProduct = ViewBag.RelatedProduct as IEnumerable<ProductModel>;
}


<!-- Product Details Section Begin -->
<section class="product-details spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 col-md-6">
                <div class="product__details__pic">
                    <div class="product__details__pic__item">
                        <img class="product__details__pic__item--large"
                             src="/@(GetPath.ProductImage + Model.Productimages.First().Productimageurl)" alt="">
                    </div>
                    <div class="product__details__pic__slider owl-carousel">
                        @{
                            foreach (var item in Model.Productimages)
                            {
                                <img data-imgbigurl="/@(GetPath.ProductImage + item.Productimageurl)"
                                 src="/@(GetPath.ProductImage + item.Productimageurl)" alt="">
                            }
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6">
                <div class="product__details__text">
                    @if (Model.Productishot == true)
                    {
                        <span class="fa fa-heart-o text-danger font-weight-bold font-italic"> Hot item </span>
                    }
                    <h3>

                        @Model.Productname
                    </h3>
                    <div class="product__details__price"> @String.Format("{0:n0}", Model.Productsaleprice) VNĐ</div>

                    @{
                        if (Model.Productsaleprice != Model.Productprice)
                        {
                            <h4 class="mb-4 font-weight-bold"> <s>@String.Format("{0:n0}", Model.Productprice) VNĐ </s></h4>
                        }
                    }
                    <div class="product__details__quantity">
                        <div class="quantity">
                            <div class="pro-qty">
                                <span class="dec qtybtn">-</span>
                                <input type="text" value="1" min="1" max="@Model.Productquantity" step="1" id="txtQuantity">
                                <span class="inc qtybtn">+</span>
                            </div>
                        </div>
                    </div>
                    <input type="text" id="txtProductId" value="@Model.Productid" hidden />
                    <button id="add-to-cart" class="primary-btn" type="submit">Thêm vào giỏ hàng</button>
                    <a href="#" class="heart-icon"><span class="icon_heart_alt"></span></a>
                    <ul>
                        <li>
                            <b>Có sẵn: </b>
                            <span>
                                <input value="@Model.Productquantity"
                                       class="bg-white border-0" disabled id="maxQuantity" />
                            </span>
                        </li>
                        <li><b>Phí vận chuyển:</b> <span>30,000 VNĐ </span></li>
                        <li><i>Miễn phí vận chuyển cho mọi đơn hàng từ 250,000 VNĐ </i></li>
                        <li>
                            <b>Chia sẻ:</b>
                            <div class="share">
                                <a href="@("https://www.facebook.com/sharer/sharer.php?u="+ Context.Request.GetEncodedUrl())" target="_blank">
                                    <i class="fa fa-facebook"></i>
                                </a>
                                <a href="@("https://twitter.com/intent/tweet?text="+Context.Request.GetEncodedUrl())" target="_blank">
                                    <i class="fa fa-twitter"></i>
                                </a>

                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="product__details__tab">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab"
                               aria-selected="true">Mô tả sản phẩm</a>
                        </li>

                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tabs-1" role="tabpanel">
                            <div class="product__details__tab__desc">
                                @Html.Raw(Model.Productdescribe)
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Product Details Section End -->
<!-- Related Product Section Begin -->
<section class="related-product">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="section-title related__product__title">
                    <h2>Sản phẩm tương tự</h2>
                </div>
            </div>
        </div>
        <div class="row">
            @{
                if (relatedProduct != null && relatedProduct.Count() > 0)
                {
                    foreach (var item in relatedProduct)
                    {
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <partial name="_productPartial" model="item"></partial>
                        </div>
                    }
                }
            }
        </div>
    </div>
</section>
<!-- Related Product Section End -->
@section Scripts{
    <script>
        $(document).ready(function () {
            $(function () {

                $("#add-to-cart").click(function () {
                    var productid = $('#txtProductId').val();
                    var soLuong = $('#txtQuantity').val();
                    $.ajax({
                        url: '/Shopping/AddToCart',
                        type: "POST",
                        dataType: "JSON",
                        data: {
                            productId: productid,
                            quantity: soLuong
                        },
                        success: function (response) {
                            if (typeof response !== "undefined") {
                                $('#header-card-quatity').load("/CartAjax/HeaderCart")
                                $.notify("Đã thêm vào giỏ hàng.", "success");
                            }
                            else {
                                $.notify("Kiểm tra lại số lượng sản phẩm.")
                            }
                        },
                        error: function (error) {
                            alert("There was an error posting the data to the server: " + error.responseText);
                        }
                    });
                });

                $.fn.ValidQuantity = function () {
                    let value = parseInt($("#txtQuantity").val());
                    let maxValue = parseInt($("#maxQuantity").val());
                    if (Number.isNaN(value)) {
                        $("#txtQuantity").val(1);
                    }
                    else if (value < 1) {
                        $("#txtQuantity").val(1);
                    }
                    else if (value > maxValue) {
                        $("#txtQuantity").val(maxValue);
                    }
                    else {
                        $("#txtQuantity").val(value);
                    }
                }

                $("#txtQuantity").change(function () {
                    $.fn.ValidQuantity()
                });
                $('.qtybtn').bind("mouseout", function () {
                    $.fn.ValidQuantity()
                });


            })

        })

    </script>

}